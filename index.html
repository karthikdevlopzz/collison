<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particle Universe Sandbox</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            overflow: hidden;
        }

        body {
            background: #000;
            font-family: 'Courier New', monospace;
            cursor: crosshair;
        }

        canvas {
            display: block;
            background: radial-gradient(ellipse at center, #0a0a2a 0%, #000000 100%);
        }

        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            min-width: 250px;
        }

        .controls h2 {
            margin-bottom: 15px;
            color: #ff6b6b;
            text-shadow: 0 0 10px #ff6b6b;
        }

        .control-group {
            margin-bottom: 15px;
        }

        .control-group label {
            display: block;
            margin-bottom: 5px;
            color: #4ecdc4;
            font-size: 12px;
        }

        input[type="range"] {
            width: 100%;
            height: 5px;
            background: #333;
            outline: none;
            border-radius: 5px;
        }

        input[type="range"]::-webkit-slider-thumb {
            width: 15px;
            height: 15px;
            background: #4ecdc4;
            cursor: pointer;
            border-radius: 50%;
        }

        button {
            width: 100%;
            padding: 10px;
            margin-top: 5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .stats {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            font-size: 14px;
        }

        .stats div {
            margin-bottom: 5px;
        }

        .mode-indicator {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: #fff;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            font-size: 14px;
            text-align: center;
        }

        .trail {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0.6;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="controls">
        <h2>üåå Universe Controls</h2>
        
        <div class="control-group">
            <label>Particle Mass: <span id="massValue">5</span></label>
            <input type="range" id="massSlider" min="1" max="20" value="5">
        </div>
        
        <div class="control-group">
            <label>Particle Type</label>
            <button id="starBtn" style="background: linear-gradient(45deg, #ffeb3b, #ff9800)">‚≠ê Star</button>
            <button id="planetBtn" style="background: linear-gradient(45deg, #4caf50, #2196f3)">üåç Planet</button>
            <button id="blackholeBtn" style="background: linear-gradient(45deg, #9c27b0, #673ab7)">‚ö´ Black Hole</button>
        </div>
        
        <div class="control-group">
            <button id="clearBtn" style="background: #f44336">üóëÔ∏è Clear Universe</button>
            <button id="pauseBtn">‚è∏Ô∏è Pause/Play</button>
            <button id="trailsBtn">‚ú® Toggle Trails</button>
        </div>
    </div>
    
    <div class="stats">
        <div>Bodies: <span id="bodyCount">0</span></div>
        <div>FPS: <span id="fps">60</span></div>
        <div>Total Mass: <span id="totalMass">0</span></div>
    </div>
    
    <div class="mode-indicator">
        Click to spawn: <span id="currentMode" style="color: #ffeb3b">‚≠ê Star</span>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Particle types
        const PARTICLE_TYPES = {
            STAR: { color: '#ffeb3b', glow: '#ff9800', gravityMultiplier: 2 },
            PLANET: { color: '#4caf50', glow: '#2196f3', gravityMultiplier: 1 },
            BLACKHOLE: { color: '#9c27b0', glow: '#673ab7', gravityMultiplier: 5 }
        };

        // State
        let particles = [];
        let currentType = 'STAR';
        let currentMass = 5;
        let isPaused = false;
        let showTrails = true;
        let mouseX = 0;
        let mouseY = 0;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let fps = 60;
        let lastTime = performance.now();

        // Particle class
        class Particle {
            constructor(x, y, vx, vy, mass, type) {
                this.x = x;
                this.y = y;
                this.vx = vx;
                this.vy = vy;
                this.mass = mass;
                this.radius = Math.sqrt(mass) * 3;
                this.type = type;
                this.trail = [];
                this.maxTrailLength = 50;
                this.glowIntensity = 1;
                this.alive = true;
            }

            update(particles) {
                if (!this.alive) return;

                // Apply gravity from other particles
                particles.forEach(other => {
                    if (other !== this && other.alive) {
                        const dx = other.x - this.x;
                        const dy = other.y - this.y;
                        const distSq = dx * dx + dy * dy;
                        const dist = Math.sqrt(distSq);

                        // Collision detection
                        if (dist < this.radius + other.radius) {
                            this.handleCollision(other);
                            return;
                        }

                        // Gravitational force
                        const force = (0.5 * this.mass * other.mass) / distSq;
                        const ax = (force * dx / dist) / this.mass;
                        const ay = (force * dy / dist) / this.mass;

                        this.vx += ax * PARTICLE_TYPES[other.type].gravityMultiplier;
                        this.vy += ay * PARTICLE_TYPES[other.type].gravityMultiplier;
                    }
                });

                // Update position
                this.x += this.vx;
                this.y += this.vy;

                // Add to trail
                if (showTrails) {
                    this.trail.push({ x: this.x, y: this.y });
                    if (this.trail.length > this.maxTrailLength) {
                        this.trail.shift();
                    }
                }

                // Wrap around screen edges
                if (this.x < -50) this.x = canvas.width + 50;
                if (this.x > canvas.width + 50) this.x = -50;
                if (this.y < -50) this.y = canvas.height + 50;
                if (this.y > canvas.height + 50) this.y = -50;

                // Glow animation
                this.glowIntensity = 0.8 + Math.sin(Date.now() * 0.001) * 0.2;
            }

            handleCollision(other) {
                // Merge particles - larger one absorbs smaller
                if (this.mass >= other.mass) {
                    this.mass += other.mass * 0.8;
                    this.radius = Math.sqrt(this.mass) * 3;
                    // Conservation of momentum
                    this.vx = (this.vx * this.mass + other.vx * other.mass) / (this.mass + other.mass);
                    this.vy = (this.vy * this.mass + other.vy * other.mass) / (this.mass + other.mass);
                    other.alive = false;
                    
                    // Create explosion effect
                    createExplosion(other.x, other.y, other.type);
                }
            }

            draw(ctx) {
                if (!this.alive) return;

                const config = PARTICLE_TYPES[this.type];

                // Draw trail
                if (showTrails && this.trail.length > 1) {
                    ctx.strokeStyle = config.glow;
                    ctx.lineWidth = 2;
                    ctx.globalAlpha = 0.3;
                    ctx.beginPath();
                    ctx.moveTo(this.trail[0].x, this.trail[0].y);
                    for (let i = 1; i < this.trail.length; i++) {
                        ctx.lineTo(this.trail[i].x, this.trail[i].y);
                    }
                    ctx.stroke();
                    ctx.globalAlpha = 1;
                }

                // Draw glow
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius * 2);
                gradient.addColorStop(0, config.glow);
                gradient.addColorStop(0.5, config.glow + '44');
                gradient.addColorStop(1, 'transparent');
                ctx.fillStyle = gradient;
                ctx.globalAlpha = this.glowIntensity * 0.6;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 2, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;

                // Draw particle
                ctx.fillStyle = config.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();

                // Inner glow
                const innerGradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius);
                innerGradient.addColorStop(0, '#ffffff');
                innerGradient.addColorStop(0.3, config.color);
                innerGradient.addColorStop(1, config.color);
                ctx.fillStyle = innerGradient;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius * 0.8, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        // Explosion particles for collisions
        let explosionParticles = [];

        function createExplosion(x, y, type) {
            const config = PARTICLE_TYPES[type];
            for (let i = 0; i < 20; i++) {
                const angle = (Math.PI * 2 * i) / 20;
                const speed = Math.random() * 5 + 2;
                explosionParticles.push({
                    x: x,
                    y: y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1,
                    color: config.glow
                });
            }
        }

        // Event listeners
        canvas.addEventListener('mousedown', (e) => {
            dragStartX = e.clientX;
            dragStartY = e.clientY;
            isDragging = true;
        });

        canvas.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        canvas.addEventListener('mouseup', (e) => {
            if (isDragging) {
                const vx = (e.clientX - dragStartX) * 0.05;
                const vy = (e.clientY - dragStartY) * 0.05;
                particles.push(new Particle(dragStartX, dragStartY, vx, vy, currentMass, currentType));
                isDragging = false;
            }
        });

        // UI Controls
        document.getElementById('massSlider').addEventListener('input', (e) => {
            currentMass = parseInt(e.target.value);
            document.getElementById('massValue').textContent = currentMass;
        });

        document.getElementById('starBtn').addEventListener('click', () => {
            currentType = 'STAR';
            document.getElementById('currentMode').innerHTML = '‚≠ê Star';
            document.getElementById('currentMode').style.color = '#ffeb3b';
        });

        document.getElementById('planetBtn').addEventListener('click', () => {
            currentType = 'PLANET';
            document.getElementById('currentMode').innerHTML = 'üåç Planet';
            document.getElementById('currentMode').style.color = '#4caf50';
        });

        document.getElementById('blackholeBtn').addEventListener('click', () => {
            currentType = 'BLACKHOLE';
            document.getElementById('currentMode').innerHTML = '‚ö´ Black Hole';
            document.getElementById('currentMode').style.color = '#9c27b0';
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            particles = [];
            explosionParticles = [];
        });

        document.getElementById('pauseBtn').addEventListener('click', () => {
            isPaused = !isPaused;
        });

        document.getElementById('trailsBtn').addEventListener('click', () => {
            showTrails = !showTrails;
            if (!showTrails) {
                particles.forEach(p => p.trail = []);
            }
        });

        // Animation loop
        function animate() {
            // Calculate FPS
            const currentTime = performance.now();
            const deltaTime = currentTime - lastTime;
            fps = Math.round(1000 / deltaTime);
            lastTime = currentTime;

            // Clear canvas with fade effect for trails
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            if (!isPaused) {
                // Update particles
                particles = particles.filter(p => p.alive);
                particles.forEach(p => p.update(particles));

                // Update explosion particles
                explosionParticles = explosionParticles.filter(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= 0.02;
                    return p.life > 0;
                });
            }

            // Draw explosion particles
            explosionParticles.forEach(p => {
                ctx.fillStyle = p.color;
                ctx.globalAlpha = p.life;
                ctx.fillRect(p.x - 2, p.y - 2, 4, 4);
            });
            ctx.globalAlpha = 1;

            // Draw particles
            particles.forEach(p => p.draw(ctx));

            // Draw velocity preview when dragging
            if (isDragging) {
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.beginPath();
                ctx.moveTo(dragStartX, dragStartY);
                ctx.lineTo(mouseX, mouseY);
                ctx.stroke();
                ctx.setLineDash([]);

                // Preview particle
                ctx.fillStyle = PARTICLE_TYPES[currentType].color;
                ctx.globalAlpha = 0.5;
                ctx.beginPath();
                ctx.arc(dragStartX, dragStartY, Math.sqrt(currentMass) * 3, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }

            // Update stats
            document.getElementById('bodyCount').textContent = particles.length;
            document.getElementById('fps').textContent = fps;
            document.getElementById('totalMass').textContent = particles.reduce((sum, p) => sum + p.mass, 0);

            requestAnimationFrame(animate);
        }

        // Window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });

        // Start animation
        animate();

        // Add some initial particles
        for (let i = 0; i < 5; i++) {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height;
            const vx = (Math.random() - 0.5) * 2;
            const vy = (Math.random() - 0.5) * 2;
            const mass = Math.random() * 10 + 5;
            const types = ['STAR', 'PLANET'];
            const type = types[Math.floor(Math.random() * types.length)];
            particles.push(new Particle(x, y, vx, vy, mass, type));
        }
    </script>
</body>
</html>